<h2 class="text-center my-4" *ngIf="nombreUsuario">
  Hola {{ nombreUsuario || 'Usuario' }}!üëã Bienvenido(a) al panel de administrador ‚úçÔ∏èü•∏
</h2>
<div class="d-flex bg-dark">
  <div class="p-4 border-end d-flex flex-column" style="max-width: 200px; height: 100vh; color: white;">
    <h3 class="mb-3">Items</h3>
    <hr>
    <button #btnUsuarios class="btn btn-outline-light w-70 mb-2" title="Gesti√≥n de Usuarios"
      (click)="seccion = 'usuarios'">üë§<br>Usuarios</button>
    <br>
    <button class="btn btn-outline-light w-70 mb-2" title="Gesti√≥n de Videojuegos"
      (click)="seccion = 'videojuegos'">üéÆ<br>Videojuegos</button>
    <br>
    <button class="btn btn-outline-light w-70 mb-2" title="Gesti√≥n de Categorias"
      (click)="seccion = 'categorias'">üè∑Ô∏è<br>Categor√≠as</button>
    <hr>
    <button class="btn btn-danger w-70 mb-2 mt-auto" (click)="logout()">Cerrar sesi√≥n</button>
  </div>
  <!-- Gesti√≥n de usuarios -->
  <div class="flex-grow-1 p-4">
    <div *ngIf="seccion === 'usuarios'" style="color: white;">
      <!-- Encabezado con t√≠tulo y bot√≥n -->
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="mb-0">
          Listado de Usuarios
          <span *ngIf="estadoSeleccionado === 'ACTIVO'">Activos</span>
          <span *ngIf="estadoSeleccionado === 'INACTIVO'">Inactivos</span>
        </h3>
        <button class="btn btn-success d-flex align-items-center justify-content-center" title="Registrar usuario"
          style="width: 40px; height: 40px; font-size: 25pt; border-radius: 50%;" (click)="registrarUsuario()">
          <span style="position: relative; top: -2px;">+</span>
        </button>
      </div>
      <hr>
      <!-- Filtros -->
      <div class="d-flex align-items-center flex-wrap gap-4 mb-3">

        <div>
          <strong>Buscar: </strong>
          <input type="text" [(ngModel)]="textoBusqueda" (ngModelChange)="onBuscarCambio()"
            class="form-control form-control-sm d-inline-block" placeholder="Nombre o Email" style="width: 200px;" />
        </div>

        <div>
          <strong>Estado: </strong>
          <button class="btn btn-outline-light btn-sm"
            [ngClass]="estadoSeleccionado === 'ACTIVO' ? 'btn-light text-dark' : 'btn-outline-light'"
            (click)="cambiarEstado('ACTIVO')">Activo</button>
          <span class="mx-1">|</span>
          <button class="btn btn-outline-light btn-sm"
            [ngClass]="estadoSeleccionado === 'INACTIVO' ? 'btn-light text-dark' : 'btn-outline-light'"
            (click)="cambiarEstado('INACTIVO')">Inactivo</button>
        </div>

        <div>
          <strong>Rol: </strong>
          <button class="btn btn-outline-light btn-sm"
            [ngClass]="rolSeleccionado === null ? 'btn-light text-dark' : 'btn-outline-light'"
            (click)="cambiarRol(null)">Todos</button>
          <span class="mx-1">|</span>
          <button class="btn btn-outline-light btn-sm"
            [ngClass]="rolSeleccionado === 'ADMIN' ? 'btn-light text-dark' : 'btn-outline-light'"
            (click)="cambiarRol('ADMIN')">Administrador</button>
          <span class="mx-1">|</span>
          <button class="btn btn-outline-light btn-sm"
            [ngClass]="rolSeleccionado === 'USER' ? 'btn-light text-dark' : 'btn-outline-light'"
            (click)="cambiarRol('USER')">Cliente</button>
        </div>
        <!-- Tabla de usuarios -->
        <div class="table rounded-3 overflow-hidden mb-0">
          <table *ngIf="usuarios.length > 0" class="table table-hover table-bordered m-0">
            <thead style="--bs-table-bg: #0dcaf0;">
              <tr>
                <th scope="col" class="text-center">#</th>
                <th scope="col">Nombre</th>
                <th scope="col">Email</th>
                <th scope="col">Rol</th>
                <th scope="col" class="text-center">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let u of usuarios; let i = index" class="align-middle">
                <td class="text-center">{{ i + 1 + paginaActual * tamanoPagina }}</td>
                <td>{{ u.nombre }}</td>
                <td>{{ u.email }}</td>
                <td>{{ u.rol === 'ADMIN' ? 'Administrador' : u.rol === 'USER' ? 'Cliente' : u.rol }}</td>
                <td class="text-center">
                  <ng-container *ngIf="u.id !== 1">
                    <button class="btn btn-sm btn-outline-dark" style="font-size: 12pt;" (click)="actualizarUsuario(u)"
                      title="Editar Usuario">‚úèÔ∏è</button> |
                    <button *ngIf="u.estado === 'A'" class="btn btn-sm btn-outline-dark" style="font-size: 12pt;"
                      (click)="desactivarUsuario(u.id)" title="Eliminar Usuario">‚ùå</button>
                    <button *ngIf="u.estado === 'I'" class="btn btn-sm btn-outline-dark" style="font-size: 12pt;"
                      (click)="reactivarUsuario(u.id)" title="Recuperar Usuario">‚úÖ</button>
                  </ng-container>
                  <span *ngIf="u.id === 1" class="text-muted">-</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="d-flex justify-content-between align-items-center w-100">
          <!-- Total de usuarios encontrados -->
          <div class="text-white">
            <strong><em>Usuarios encontrados: {{ totalUsuarios }}</em></strong>
          </div>

          <!-- Navegaci√≥n -->
          <nav aria-label="Paginaci√≥n de usuarios">
            <ul class="pagination my-0">
              <li class="page-item" [class.disabled]="paginaActual === 0">
                <button class="page-link" style="font-size: 16pt;" (click)="irAPagina(paginaActual - 1)"
                  [disabled]="paginaActual === 0" title="Anterior p√°gina">‚¨ÖÔ∏è</button>
              </li>
              <li class="page-item" [class.disabled]="paginaActual >= totalPaginas - 1">
                <button class="page-link" style="font-size: 16pt;" (click)="irAPagina(paginaActual + 1)"
                  [disabled]="paginaActual >= totalPaginas - 1" title="Siguiente p√°gina">‚û°Ô∏è</button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
    <!-- Videojuegos -->
    <div *ngIf="seccion === 'videojuegos'" style="color: white;">
      <h3>Gesti√≥n de Videojuegos</h3>
      <p>Secci√≥n en construcci√≥n...</p>
    </div>
    <!-- Categorias -->
    <div *ngIf="seccion === 'categorias'" style="color: white;">
      <h3>Gesti√≥n de Categor√≠as</h3>
      <p>Secci√≥n en construcci√≥n...</p>
    </div>
  </div>
</div>
<!-- Modal Bootstrap -->
<div #modalActualizarUsuario class="modal fade" tabindex="-1" id="modalActualizarUsuario"
  [attr.inert]="!usuarioSeleccionado ? true : null">
  <div class="modal-dialog">
    <div class="modal-content p-5 bg-dark" style="color: white;">
      <ng-container *ngIf="usuarioSeleccionado">
        <div class="d-flex justify-content-between align-items-center ">
          <h4>{{ modoRegistro ? 'Registrar Usuario' : 'Actualizar Usuario' }}</h4>
          <button class="btn btn-light d-flex align-items-center justify-content-center" type="button"
            style="width: 40px; height: 40px; font-size: 15pt; border-radius: 50%;" (click)="cerrarModal()">
            <span style="position: relative;">‚ùå‚Äã</span>
          </button>
        </div>
        <hr>
        <form (ngSubmit)="guardarCambios()" #form="ngForm" novalidate>

          <!-- Nombre -->
          <div class="mb-3">
            <label class="form-label">Nombre</label>
            <input class="form-control" [(ngModel)]="usuarioSeleccionado.nombre" name="nombre" required maxlength="50"
              #nombreModel="ngModel" [ngClass]="{
             'is-invalid': nombreModel.invalid && (nombreModel.dirty || nombreModel.touched),
             'is-valid': nombreModel.valid && (nombreModel.dirty || nombreModel.touched)
           }" />
            <div *ngIf="nombreModel.invalid && (nombreModel.dirty || nombreModel.touched)" class="invalid-feedback">
              <div *ngIf="nombreModel.errors?.['required']">El nombre es obligatorio</div>
              <div *ngIf="nombreModel.errors?.['maxlength']">El nombre no debe superar los 50 caracteres</div>
            </div>
          </div>

          <!-- Email -->
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input class="form-control" [(ngModel)]="usuarioSeleccionado.email" name="email" required email
              pattern="^[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$" #emailModel="ngModel" [ngClass]="{
             'is-invalid': emailModel.invalid && (emailModel.dirty || emailModel.touched),
             'is-valid': emailModel.valid && (emailModel.dirty || emailModel.touched)
           }" />
            <div *ngIf="emailModel.invalid && (emailModel.dirty || emailModel.touched)" class="invalid-feedback">
              <div *ngIf="emailModel.errors?.['required']">El email es obligatorio</div>
              <div *ngIf="emailModel.errors?.['pattern']">Formato de email inv√°lido</div>
            </div>
          </div>

          <!-- Contrase√±a -->
          <div class="mb-3">
            <label class="form-label">Contrase√±a</label>
            <input class="form-control" type="password" [(ngModel)]="nuevaPassword" name="nuevaPassword"
              #passwordModel="ngModel" [ngModelOptions]="{ updateOn: 'blur' }"
              [placeholder]="!modoRegistro ? 'Dejar en blanco para no modificar' : ''" [required]="modoRegistro"
              pattern="^(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]+$" [ngClass]="{
             'is-invalid': passwordModel.invalid && (passwordModel.dirty || passwordModel.touched),
             'is-valid': passwordModel.valid && (passwordModel.dirty || passwordModel.touched)
           }" />
            <div *ngIf="passwordModel.invalid && (passwordModel.dirty || passwordModel.touched)"
              class="invalid-feedback">
              <div *ngIf="passwordModel.errors?.['required']">La contrase√±a es obligatoria</div>
              <div *ngIf="passwordModel.errors?.['pattern']">Debe tener una may√∫scula, n√∫mero y car√°cter especial
              </div>
            </div>
          </div>

          <div class="mb-3" *ngIf="!modoRegistro">
            <label class="form-label">Rol:</label>
            <select class="form-select" [(ngModel)]="usuarioSeleccionado.rol" name="rol" required>
              <option value="ADMIN">Administrador</option>
              <option value="USER">Cliente</option>
            </select>
          </div>

          <div class="d-flex justify-content-center align-items-center ">
            <button class="btn btn-info me-2" type="submit"
              [disabled]="form.invalid || !validarPassword() || usuarioSeleccionado.id === 1">{{ modoRegistro ? 'üíæ
              Registrar' : 'üíæ Guardar' }}</button>
          </div>

        </form>
      </ng-container>
    </div>
  </div>
</div>